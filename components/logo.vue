<template>
  <div :style="`height: ${strokeLength + height}px`" class="relative">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="384"
      height="480"
      class="left-1/2 -translate-x-1/2 translate-y-1/2"
      :class="{
        'fixed bottom-1/2': !animationDone,
        absolute: animationDone,
      }"
      :style="animationDone ? `bottom: ${height / 2}px` : ''"
    >
      <path
        ref="logo"
        fill="#1a523d"
        :fill-opacity="1 - strokeOpacity"
        stroke="white"
        stroke-linejoin="round"
        stroke-linecap="round"
        :stroke-width="8 * strokeOpacity"
        :stroke-opacity="strokeOpacity"
        :stroke-dasharray="strokeLength"
        :stroke-dashoffset="strokeOffset"
        d="M203.315 252.699c-6.415 47.947-6.812 95.855-6.1 143.45-25.655-42.942-38.759-90.802-35.567-141.423l-7.773.356c-1.492.068-2.616-.86-2.807-2.148l-14.966.738c-1.525.076-2.595-1.105-2.303-2.544l12.473-36.977c.278-1.362 1.671-2.406 3.09-2.315l7.885.83c.561-1.338 2.009-2.311 3.516-2.24l7.662.355c12.422-50.626 40.291-98.486 79.191-141.423-15.392 47.594-29.772 95.502-38.148 143.45l10.913 4.485 104.455-5.137c1.545-.076 2.973-1.099 3.237-2.576l.004-.027c6.568-37.843 14.893-80.068 22.938-117.583.407-1.9-.001-3.588-1.225-5.07a2602.909 2602.909 0 0 1-29.294-36.39c-1.204-1.51-2.913-2.32-5.121-2.429-59.924-2.917-119.853-5.797-179.782-8.638-2.042-.096-3.996.58-5.864 2.033A3440.135 3440.135 0 0 0 84.477 77.31c-1.852 1.492-2.99 3.272-3.412 5.336A3159.698 3159.698 0 0 0 32.87 398.583c-.212 2.102.373 3.895 1.756 5.378a2860.748 2860.748 0 0 0 33.86 35.695c1.244 1.288 5.201.899 5.201.899h173.369s4.332-.96 5.825-2.363c13.527-12.82 34.433-33.926 48.108-46.444 1.696-1.544 2.652-6.916 2.866-8.852a2899.567 2899.567 0 0 1 11.275-89.34c1.744-12.28 3.947-25.687 5.964-38.193.415-2.577-1.616-4.912-4.308-4.958l-101.236-1.752-12.23 4.065"
      />
    </svg>
  </div>
</template>

<script setup lang="ts">
const logo = ref(null as SVGPathElement | null);
const strokeLength = ref(0);
const { height } = useWindowSize();
const { y } = useWindowScroll();

const speedFactor = 2;
onMounted(() => {
  strokeLength.value = logo.value?.getTotalLength() ?? 0;
});
const strokeOffset = computed(() => {
  return Math.max(0, strokeLength.value - y.value * speedFactor);
});
const strokeOpacity = computed(() => {
  return Math.max(
    0,
    Math.min(
      1,
      1 - (y.value * speedFactor - strokeLength.value) / strokeLength.value
    )
  );
});
const animationDone = computed(() => {
  return strokeOpacity.value === 0;
});
</script>
